<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jepsen.cli documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jepsen</span> <span class="project-version">0.1.8</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jepsen</span></div></div></li><li class="depth-2 branch"><a href="jepsen.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-2"><a href="jepsen.checker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.perf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>perf</span></div></a></li><li class="depth-3"><a href="jepsen.checker.timeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timeline</span></div></a></li><li class="depth-2 branch current"><a href="jepsen.cli.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="jepsen.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="jepsen.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2"><a href="jepsen.control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.net.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.control.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="jepsen.core.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="jepsen.faketime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faketime</span></div></a></li><li class="depth-2 branch"><a href="jepsen.generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generator</span></div></a></li><li class="depth-2 branch"><a href="jepsen.independent.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>independent</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nemesis</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="jepsen.net.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.net.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="jepsen.os.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>os</span></div></a></li><li class="depth-3"><a href="jepsen.os.debian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debian</span></div></a></li><li class="depth-2 branch"><a href="jepsen.reconnect.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>reconnect</span></div></a></li><li class="depth-2 branch"><a href="jepsen.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="jepsen.report.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></a></li><li class="depth-2 branch"><a href="jepsen.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-2 branch"><a href="jepsen.tests.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-2 branch"><a href="jepsen.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="jepsen.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jepsen.cli.html#var--main"><div class="inner"><span>-main</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-default-nodes"><div class="inner"><span>default-nodes</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-help-opt"><div class="inner"><span>help-opt</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-one-of"><div class="inner"><span>one-of</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-package-opt"><div class="inner"><span>package-opt</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-parse-concurrency"><div class="inner"><span>parse-concurrency</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-read-nodes-file"><div class="inner"><span>read-nodes-file</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-rename-keys"><div class="inner"><span>rename-keys</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-rename-options"><div class="inner"><span>rename-options</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-rename-ssh-options"><div class="inner"><span>rename-ssh-options</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-repeated-opt"><div class="inner"><span>repeated-opt</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-run.21"><div class="inner"><span>run!</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-serve-cmd"><div class="inner"><span>serve-cmd</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-single-test-cmd"><div class="inner"><span>single-test-cmd</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-tarball-opt"><div class="inner"><span>tarball-opt</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-test-opt-fn"><div class="inner"><span>test-opt-fn</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-test-opt-spec"><div class="inner"><span>test-opt-spec</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-test-usage"><div class="inner"><span>test-usage</span></div></a></li><li class="depth-1"><a href="jepsen.cli.html#var-validate-tarball"><div class="inner"><span>validate-tarball</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jepsen.cli</h1><div class="doc"><div class="markdown"><p>Command line interface. Provides a default main method for common Jepsen functions (like the web interface), and utility functions for Jepsen tests to create their own test runners.</p></div></div><div class="public anchor" id="var--main"><h3>-main</h3><div class="usage"><code>(-main &amp; args)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L333">view source</a></div></div><div class="public anchor" id="var-default-nodes"><h3>default-nodes</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L15">view source</a></div></div><div class="public anchor" id="var-help-opt"><h3>help-opt</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L49">view source</a></div></div><div class="public anchor" id="var-one-of"><h3>one-of</h3><div class="usage"><code>(one-of coll)</code></div><div class="doc"><div class="markdown"><p>Takes a collection and returns a string like “Must be one of …” and a list of names. For maps, uses keys.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L17">view source</a></div></div><div class="public anchor" id="var-package-opt"><h3>package-opt</h3><div class="usage"><code>(package-opt default)</code><code>(package-opt option-name default)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L89">view source</a></div></div><div class="public anchor" id="var-parse-concurrency"><h3>parse-concurrency</h3><div class="usage"><code>(parse-concurrency parsed)</code></div><div class="doc"><div class="markdown"><p>Takes a parsed map. Parses :concurrency; if it is a string ending with n, e.g 3n, sets it to 3 * the number of :nodes. Otherwise, parses as a plain integer.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L125">view source</a></div></div><div class="public anchor" id="var-read-nodes-file"><h3>read-nodes-file</h3><div class="usage"><code>(read-nodes-file parsed)</code></div><div class="doc"><div class="markdown"><p>Takes a parsed map. If :nodes-file exists, reads its contents and appends them to :nodes. Drops the default nodes list if it’s still there.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L176">view source</a></div></div><div class="public anchor" id="var-rename-keys"><h3>rename-keys</h3><div class="usage"><code>(rename-keys m replacements)</code></div><div class="doc"><div class="markdown"><p>Given a map m, and a map of keys to replacement keys, yields m with keys renamed.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L142">view source</a></div></div><div class="public anchor" id="var-rename-options"><h3>rename-options</h3><div class="usage"><code>(rename-options parsed replacements)</code></div><div class="doc"><div class="markdown"><p>Like rename-keys, but takes a parsed map and updates keys in :options.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L153">view source</a></div></div><div class="public anchor" id="var-rename-ssh-options"><h3>rename-ssh-options</h3><div class="usage"><code>(rename-ssh-options parsed)</code></div><div class="doc"><div class="markdown"><p>Takes a parsed map and moves SSH options to a map under :ssh.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L158">view source</a></div></div><div class="public anchor" id="var-repeated-opt"><h3>repeated-opt</h3><div class="usage"><code>(repeated-opt short-opt long-opt docstring default)</code><code>(repeated-opt short-opt long-opt docstring default parse-map)</code></div><div class="doc"><div class="markdown"><p>Helper for vector options where we want to replace the default vector (checking via identical?) if any options are passed, building a vector for multiple args. If parse-map is provided (a map of string cmdline options to parsed values), the special word “all” can be used to specify every value in the map.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L24">view source</a></div></div><div class="public anchor" id="var-run.21"><h3>run!</h3><div class="usage"><code>(run! subcommands [command &amp; arguments])</code></div><div class="doc"><div class="markdown"><p>Parses arguments and runs tests, etc. Takes a map of subcommand names to subcommand-specs, and a list of arguments. Each subcommand-spec is a map with the following keys:</p>
<p>:opt-spec - The option parsing spec to use. :opt-fn - A function to transform the tools.cli options map, e.g.  {:options …, :arguments …, :summary …}. Default:  identity :usage - A usage string (default: “Usage:”) :run - Function to execute with the transformed options  (default: pprint)</p>
<p>If an unrecognized (or no command) is given, prints out a general usage guide and exits.</p>
<p>For a subcommand, if help or –help is given, prints out a help string with usage for the given subcommand and exits with status 0.</p>
<p>If invalid arguments are given, prints those errors to the console, and exits with status 254.</p>
<p>Finally, if everything looks good, calls the given subcommand’s <code>run</code> function with parsed options, and exits with status 0.</p>
<p>Catches exceptions, logs them to the console, and exits with status 255.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L203">view source</a></div></div><div class="public anchor" id="var-serve-cmd"><h3>serve-cmd</h3><div class="usage"><code>(serve-cmd)</code></div><div class="doc"><div class="markdown"><p>A web server command.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L280">view source</a></div></div><div class="public anchor" id="var-single-test-cmd"><h3>single-test-cmd</h3><div class="usage"><code>(single-test-cmd opts)</code></div><div class="doc"><div class="markdown"><p>A command which runs a single test with standard built-ins. Options:</p>
<p>{:opt-spec A vector of additional options for tools.cli. Appended to  <code>test-opt-spec</code>. Optional.  :opt-fn A function which transforms parsed options. Composed after  <code>test-opt-fn</code>. Optional.  :tarball If present, adds a –tarball option to this command, defaulting to  whatever URL is given here.  :usage Defaults to <code>jc/test-usage</code>. Optional.  :test-fn A function that receives the option map and constructs a test.}</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L297">view source</a></div></div><div class="public anchor" id="var-tarball-opt"><h3>tarball-opt</h3><div class="usage"><code>(tarball-opt default)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L99">view source</a></div></div><div class="public anchor" id="var-test-opt-fn"><h3>test-opt-fn</h3><div class="usage"><code>(test-opt-fn parsed)</code></div><div class="doc"><div class="markdown"><p>An opt fn for running simple tests. Remaps ssh keys, remaps :node to :nodes, reads :nodes-file into :nodes, and parses :concurrency.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L191">view source</a></div></div><div class="public anchor" id="var-test-opt-spec"><h3>test-opt-spec</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Command line options for testing.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L52">view source</a></div></div><div class="public anchor" id="var-test-usage"><h3>test-usage</h3><div class="usage"><code>(test-usage)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L103">view source</a></div></div><div class="public anchor" id="var-validate-tarball"><h3>validate-tarball</h3><div class="usage"><code>(validate-tarball parsed)</code></div><div class="doc"><div class="markdown"><p>Takes a parsed map and ensures a tarball is present.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.8/jepsen/src/jepsen/cli.clj#L118">view source</a></div></div></div></body></html>