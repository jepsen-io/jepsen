<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jepsen.nemesis.combined documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jepsen</span> <span class="project-version">0.2.4</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jepsen</span></div></div></li><li class="depth-2 branch"><a href="jepsen.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-2"><a href="jepsen.checker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clock</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.perf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>perf</span></div></a></li><li class="depth-3"><a href="jepsen.checker.timeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timeline</span></div></a></li><li class="depth-2 branch"><a href="jepsen.cli.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="jepsen.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="jepsen.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2"><a href="jepsen.control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.clj-ssh.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-ssh</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.docker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>docker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.k8s.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>k8s</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.net.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.retry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>retry</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.scp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scp</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.sshj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sshj</span></div></a></li><li class="depth-3"><a href="jepsen.control.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="jepsen.core.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="jepsen.faketime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faketime</span></div></a></li><li class="depth-2 branch"><a href="jepsen.fs-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fs-cache</span></div></a></li><li class="depth-2"><a href="jepsen.generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generator</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.interpreter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interpreter</span></div></a></li><li class="depth-3"><a href="jepsen.generator.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-2 branch"><a href="jepsen.independent.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>independent</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nemesis</span></div></a></li><li class="depth-3 branch current"><a href="jepsen.nemesis.combined.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>combined</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.membership.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>membership</span></div></a></li><li class="depth-4"><a href="jepsen.nemesis.membership.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.time.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="jepsen.net.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.net.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="jepsen.os.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>os</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.centos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>centos</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.debian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debian</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.smartos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smartos</span></div></a></li><li class="depth-3"><a href="jepsen.os.ubuntu.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ubuntu</span></div></a></li><li class="depth-2 branch"><a href="jepsen.reconnect.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>reconnect</span></div></a></li><li class="depth-2 branch"><a href="jepsen.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="jepsen.report.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></a></li><li class="depth-2 branch"><a href="jepsen.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-2"><a href="jepsen.tests.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.bank.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bank</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal-reverse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-reverse</span></div></a></li><li class="depth-3"><a href="jepsen.tests.cycle.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cycle</span></div></a></li><li class="depth-4 branch"><a href="jepsen.tests.cycle.append.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>append</span></div></a></li><li class="depth-4"><a href="jepsen.tests.cycle.wr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wr</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.linearizable-register.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>linearizable-register</span></div></a></li><li class="depth-3"><a href="jepsen.tests.long-fork.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>long-fork</span></div></a></li><li class="depth-2 branch"><a href="jepsen.util.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="jepsen.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-clock-package"><div class="inner"><span>clock-package</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-compose-packages"><div class="inner"><span>compose-packages</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-db-generators"><div class="inner"><span>db-generators</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-db-nemesis"><div class="inner"><span>db-nemesis</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-db-nodes"><div class="inner"><span>db-nodes</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-db-package"><div class="inner"><span>db-package</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-default-interval"><div class="inner"><span>default-interval</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-f-map"><div class="inner"><span>f-map</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-f-map-perf"><div class="inner"><span>f-map-perf</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-grudge"><div class="inner"><span>grudge</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-nemesis-package"><div class="inner"><span>nemesis-package</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-nemesis-packages"><div class="inner"><span>nemesis-packages</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-node-specs"><div class="inner"><span>node-specs</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-noop"><div class="inner"><span>noop</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-partition-nemesis"><div class="inner"><span>partition-nemesis</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-partition-package"><div class="inner"><span>partition-package</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.combined.html#var-partition-specs"><div class="inner"><span>partition-specs</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jepsen.nemesis.combined</h1><div class="doc"><div class="markdown"><p>A nemesis which combines common operations on nodes and processes: clock skew, crashes, pauses, and partitions. So far, writing these sorts of nemeses has involved lots of special cases. I expect that the API for specifying these nemeses is going to fluctuate as we figure out how to integrate those special cases appropriately. Consider this API unstable.</p>
<p>This namespace introduces a new abstraction. A <code>nemesis+generator</code> is a map with a nemesis and a generator for that nemesis. This enables us to write an algebra for composing both simultaneously. We call checkers+generators+clients a “workload”, but I don’t have a good word for this except “nemesis”. If you can think of a good word, please let me know.</p>
<p>We also take advantage of the Process and Pause protocols in jepsen.db, which allow us to start, kill, pause, and resume processes.</p></div></div><div class="public anchor" id="var-clock-package"><h3>clock-package</h3><div class="usage"><code>(clock-package opts)</code></div><div class="doc"><div class="markdown"><p>A nemesis and generator package for modifying clocks. Options as for nemesis-package.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L248">view source</a></div></div><div class="public anchor" id="var-compose-packages"><h3>compose-packages</h3><div class="usage"><code>(compose-packages packages)</code></div><div class="doc"><div class="markdown"><p>Takes a collection of nemesis+generators packages and combines them into one. Generators are combined with gen/any. Final generators proceed sequentially.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L305">view source</a></div></div><div class="public anchor" id="var-db-generators"><h3>db-generators</h3><div class="usage"><code>(db-generators opts)</code></div><div class="doc"><div class="markdown"><p>A map with a :generator and a :final-generator for DB-related operations. Options are from nemesis-package.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L100">view source</a></div></div><div class="public anchor" id="var-db-nemesis"><h3>db-nemesis</h3><div class="usage"><code>(db-nemesis db)</code></div><div class="doc"><div class="markdown"><p>A nemesis which can perform various DB-specific operations on nodes. Takes a database to operate on. This nemesis responds to the following f’s:</p>
<p>:start  :kill  :pause  :resume</p>
<p>In all cases, the :value is a node spec, as interpreted by db-nodes.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L70">view source</a></div></div><div class="public anchor" id="var-db-nodes"><h3>db-nodes</h3><div class="usage"><code>(db-nodes test db node-spec)</code></div><div class="doc"><div class="markdown"><p>Takes a test, a DB, and a node specification. Returns a collection of nodes taken from that test. node-spec may be one of:</p>
<p>nil - Chooses a random, non-empty subset of nodes  :one - Chooses a single random node  :minority - Chooses a random minority of nodes  :majority - Chooses a random majority of nodes  :minority-third - Up to, but not including, 1/3rd of nodes  :primaries - A random nonempty subset of nodes which we think are  primaries  :all - All nodes  [“a”, …] - The specified nodes</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L38">view source</a></div></div><div class="public anchor" id="var-db-package"><h3>db-package</h3><div class="usage"><code>(db-package opts)</code></div><div class="doc"><div class="markdown"><p>A nemesis and generator package for acting on a single DB. Options are from nemesis-package.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L141">view source</a></div></div><div class="public anchor" id="var-default-interval"><h3>default-interval</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The default interval, in seconds, between nemesis operations.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L27">view source</a></div></div><div class="public anchor" id="var-f-map"><h3>f-map</h3><div class="usage"><code>(f-map lift pkg)</code></div><div class="doc"><div class="markdown"><p>Takes a function <code>lift</code> which (presumably injectively) transforms the :f values used in operations, and a nemesis package. Yields a new nemesis package which uses the lifted fs. See generator/f-map and nemesis/f-map.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L294">view source</a></div></div><div class="public anchor" id="var-f-map-perf"><h3>f-map-perf</h3><div class="usage"><code>(f-map-perf lift perf)</code></div><div class="doc"><div class="markdown"><p>Takes a perf map, and transforms the fs in it using <code>lift</code>.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L282">view source</a></div></div><div class="public anchor" id="var-grudge"><h3>grudge</h3><div class="usage"><code>(grudge test db part-spec)</code></div><div class="doc"><div class="markdown"><p>Computes a grudge from a partition spec. Spec may be one of:</p>
<p>:one Isolates a single node :majority A clean majority/minority split :majorities-ring Overlapping majorities in a ring :minority-third Cleanly splits away up to, but not including, 1/3rd of  nodes :primaries Isolates a nonempty subset of primaries into  single-node components</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L162">view source</a></div></div><div class="public anchor" id="var-nemesis-package"><h3>nemesis-package</h3><div class="usage"><code>(nemesis-package opts)</code></div><div class="doc"><div class="markdown"><p>Takes an option map, and returns a map with a :nemesis, a :generator for its operations, a :final-generator to clean up any failure modes at the end of a test, and a :perf map that can be passed to checker/perf to render nice graphs.</p>
<p>This nemesis is intended for throwing a broad array of simple failures at the wall, and seeing “what sticks”. Once you’ve found a fault, you can restrict the failure modes to specific types of faults, and specific targets for those faults, to try and reproduce it faster.</p>
<p>This nemesis is <em>not</em> intended for complex sequences of faults, like partitionining away a leader, flipping some switch, adjusting the clock on an unrelated node, then crashing someone else. I don’t think I can devise a good declarative langauge for that in a way which is simpler than “generators” themselves. For those types of faults, you’ll write your own generator instead, but you may be able to use this <em>nemesis</em> to execute some or all of those operations.</p>
<p>Mandatory options:</p>
<p>:db The database you’d like to act on</p>
<p>Optional options:</p>
<p>:interval The interval between operations, in seconds.  :faults A collection of enabled faults, e.g. [:partition, :kill, …]  :partition Controls network partitions  :kill Controls process kills  :pause Controls process pauses and restarts</p>
<p>Possible faults:</p>
<p>:partition  :kill  :pause  :clock</p>
<p>Partition options:</p>
<p>:targets A collection of partition specs, e.g. [:majorities-ring, …]</p>
<p>Kill and Pause options:</p>
<p>:targets A collection of node specs, e.g. [:one, :all]</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L328">view source</a></div></div><div class="public anchor" id="var-nemesis-packages"><h3>nemesis-packages</h3><div class="usage"><code>(nemesis-packages opts)</code></div><div class="doc"><div class="markdown"><p>Just like nemesis-package, but returns a collection of packages, rather than the combined package, so you can manipulate it further before composition.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L318">view source</a></div></div><div class="public anchor" id="var-node-specs"><h3>node-specs</h3><div class="usage"><code>(node-specs db)</code></div><div class="doc"><div class="markdown"><p>Returns all possible node specification for the given DB. Helpful when you don’t know WHAT you want to test.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L63">view source</a></div></div><div class="public anchor" id="var-noop"><h3>noop</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A package which does nothing.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L31">view source</a></div></div><div class="public anchor" id="var-partition-nemesis"><h3>partition-nemesis</h3><div class="usage"><code>(partition-nemesis db)</code><code>(partition-nemesis db p)</code></div><div class="doc"><div class="markdown"><p>Wraps a partitioner nemesis with support for partition specs. Uses db to determine primaries.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L196">view source</a></div></div><div class="public anchor" id="var-partition-package"><h3>partition-package</h3><div class="usage"><code>(partition-package opts)</code></div><div class="doc"><div class="markdown"><p>A nemesis and generator package for network partitions. Options as for nemesis-package.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L226">view source</a></div></div><div class="public anchor" id="var-partition-specs"><h3>partition-specs</h3><div class="usage"><code>(partition-specs db)</code></div><div class="doc"><div class="markdown"><p>All possible partition specs for a DB.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.2.4/jepsen/src/jepsen/nemesis/combined.clj#L190">view source</a></div></div></div></body></html>