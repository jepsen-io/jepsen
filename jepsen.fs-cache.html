<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jepsen.fs-cache documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jepsen</span> <span class="project-version">0.3.5</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jepsen</span></div></div></li><li class="depth-2 branch"><a href="jepsen.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-2"><a href="jepsen.checker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clock</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.perf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>perf</span></div></a></li><li class="depth-3"><a href="jepsen.checker.timeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timeline</span></div></a></li><li class="depth-2 branch"><a href="jepsen.cli.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="jepsen.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="jepsen.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2"><a href="jepsen.control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.clj-ssh.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-ssh</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.docker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>docker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.k8s.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>k8s</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.net.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.retry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>retry</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.scp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scp</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.sshj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sshj</span></div></a></li><li class="depth-3"><a href="jepsen.control.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="jepsen.core.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="jepsen.faketime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faketime</span></div></a></li><li class="depth-2 branch current"><a href="jepsen.fs-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fs-cache</span></div></a></li><li class="depth-2"><a href="jepsen.generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generator</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>context</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.interpreter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interpreter</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-3"><a href="jepsen.generator.translation-table.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>translation-table</span></div></a></li><li class="depth-2 branch"><a href="jepsen.independent.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>independent</span></div></a></li><li class="depth-2 branch"><a href="jepsen.lazyfs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lazyfs</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nemesis</span></div></a></li><li class="depth-3 branch"><a href="jepsen.nemesis.combined.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>combined</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.membership.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>membership</span></div></a></li><li class="depth-4"><a href="jepsen.nemesis.membership.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.time.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="jepsen.net.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.net.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="jepsen.os.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>os</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.centos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>centos</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.debian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debian</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.smartos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smartos</span></div></a></li><li class="depth-3"><a href="jepsen.os.ubuntu.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ubuntu</span></div></a></li><li class="depth-2 branch"><a href="jepsen.reconnect.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>reconnect</span></div></a></li><li class="depth-2 branch"><a href="jepsen.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="jepsen.report.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></a></li><li class="depth-2"><a href="jepsen.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-3 branch"><a href="jepsen.store.format.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>format</span></div></a></li><li class="depth-3"><a href="jepsen.store.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2"><a href="jepsen.tests.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.bank.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bank</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal-reverse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-reverse</span></div></a></li><li class="depth-3"><a href="jepsen.tests.cycle.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cycle</span></div></a></li><li class="depth-4 branch"><a href="jepsen.tests.cycle.append.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>append</span></div></a></li><li class="depth-4"><a href="jepsen.tests.cycle.wr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wr</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.kafka.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>kafka</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.linearizable-register.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>linearizable-register</span></div></a></li><li class="depth-3"><a href="jepsen.tests.long-fork.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>long-fork</span></div></a></li><li class="depth-2 branch"><a href="jepsen.util.html"><div class="inner"><span class="tree" style="top: -331px;"><span class="top" style="height: 340px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="jepsen.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jepsen.fs-cache.html#var-atomic-move.21"><div class="inner"><span>atomic-move!</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-cached.3F"><div class="inner"><span>cached?</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-clear.21"><div class="inner"><span>clear!</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-deploy-remote.21"><div class="inner"><span>deploy-remote!</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-dir"><div class="inner"><span>dir</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-dir-prefix"><div class="inner"><span>dir-prefix</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-Encode"><div class="inner"><span>Encode</span></div></a></li><li class="depth-2"><a href="jepsen.fs-cache.html#var-encode-path-component"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>encode-path-component</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-escape"><div class="inner"><span>escape</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-file"><div class="inner"><span>file</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-file.21"><div class="inner"><span>file!</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-file-prefix"><div class="inner"><span>file-prefix</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-fs-path"><div class="inner"><span>fs-path</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-load-edn"><div class="inner"><span>load-edn</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-load-file"><div class="inner"><span>load-file</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-load-string"><div class="inner"><span>load-string</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-locking"><div class="inner"><span>locking</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-locks"><div class="inner"><span>locks</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-save-edn.21"><div class="inner"><span>save-edn!</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-save-file.21"><div class="inner"><span>save-file!</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-save-remote.21"><div class="inner"><span>save-remote!</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-save-string.21"><div class="inner"><span>save-string!</span></div></a></li><li class="depth-1"><a href="jepsen.fs-cache.html#var-write-atomic.21"><div class="inner"><span>write-atomic!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jepsen.fs-cache</h1><div class="doc"><div class="markdown"><p>Some systems Jepsen tests are expensive or time-consuming to set up. They might involve lengthy compilation processes, large packages which take a long time to download, or allocate large files on initial startup.</p>
<p>Other systems require state which persists from run to run–for instance, there might be an expensive initial cluster join process, and you might want to perform that process once, save the cluster’s state to disk before testing, and for subsequent tests redeploy that state to nodes to skip the cluster join.</p>
<p>This namespace provides a persistent cache, stored on the control node’s filesystem, which is suitable for strings, data, or files. It also provides a basic locking mechanism.</p>
<p>Cached values are referred to by logical <em>paths</em>: a vector of strings, keywords, numbers, booleans, etc; see the Encode protocol for details. For instance, a cache path could be any of</p>
<p><a href=":hi">:hi</a> <a href="1 true">1 true</a> <a href=":foodb :license :key">:foodb :license :key</a> <a href=":foodb &quot;1523a6b&quot;">:foodb “1523a6b”</a></p>
<p>Cached paths can be stored and retrieved in several ways. Each storage type has a pair of functions: (cache/save-string! path “foo”) writes “foo” to <code>path</code>, and (cache/load-string path) returns the stored value as a string.</p>
<ul>
<li>As strings (save-string!, load-string)</li>
<li>As EDN data (save-edn!, load-edn)</li>
<li>As raw File objects (save-file!, load-file)</li>
<li>As remote files (save-remote!, deploy-remote!)</li>
</ul>
<p>In general, writers are <code>(save-format! from-source to-path)</code>, and return <code>from-source</code>, allowing them to be used transparently for side effects. Readers are <code>(load-format path)</code>, and return <code>nil</code> if the value is uncached. You can use <code>(cached? path)</code> to distinguish between a missing cache value and a present <code>nil</code>.</p>
<p>Writes to cache are atomic: a temporary file will be written to first, then renamed into its final cache location.</p>
<p>You can acquire locks on any cache path, whether it exists or not, using <code>(locking path ...)</code>.</p>
</div></div><div class="public anchor" id="var-atomic-move.21"><h3>atomic-move!</h3><div class="usage"><code>(atomic-move! f1 f2)</code></div><div class="doc"><div class="markdown"><p>Attempts to move a file atomically, even across filesystems.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L141">view source</a></div></div><div class="public anchor" id="var-cached.3F"><h3>cached?</h3><div class="usage"><code>(cached? path)</code></div><div class="doc"><div class="markdown"><p>Do we have the given path cached?</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L187">view source</a></div></div><div class="public anchor" id="var-clear.21"><h3>clear!</h3><div class="usage"><code>(clear!)</code><code>(clear! path)</code></div><div class="doc"><div class="markdown"><p>Clears the entire cache, or a specified path.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L192">view source</a></div></div><div class="public anchor" id="var-deploy-remote.21"><h3>deploy-remote!</h3><div class="usage"><code>(deploy-remote! cache-path remote-path)</code></div><div class="doc"><div class="markdown"><p>Deploys a cached path to the given remote path (a string). Deletes remote path first. Creates parents if necessary. Returns remote path.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L255">view source</a></div></div><div class="public anchor" id="var-dir"><h3>dir</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Top-level cache directory.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L62">view source</a></div></div><div class="public anchor" id="var-dir-prefix"><h3>dir-prefix</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>What string do we prefix to directories in cache path filenames, to distinguish /foo from /foo/bar?</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L66">view source</a></div></div><div class="public anchor" id="var-Encode"><h3>Encode</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-encode-path-component"><h3>encode-path-component</h3><div class="usage"><code>(encode-path-component component)</code></div><div class="doc"><div class="markdown"><p>Encodes datatypes to strings which can be used in filenames. Use <code>escape</code> to escape slashes.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L81">view source</a></div></div><div class="public anchor" id="var-escape"><h3>escape</h3><div class="usage"><code>(escape string)</code></div><div class="doc"><div class="markdown"><p>Escapes slashes in filenames.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L76">view source</a></div></div><div class="public anchor" id="var-file"><h3>file</h3><div class="usage"><code>(file path)</code></div><div class="doc"><div class="markdown"><p>The local File backing a given path, whether or not it exists.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L129">view source</a></div></div><div class="public anchor" id="var-file.21"><h3>file!</h3><div class="usage"><code>(file! path)</code></div><div class="doc"><div class="markdown"><p>Like file, but ensures parents exist.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L134">view source</a></div></div><div class="public anchor" id="var-file-prefix"><h3>file-prefix</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>What string do we prefix to files in cache path filenames, to distinguish /foo from /foo/bar?</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L71">view source</a></div></div><div class="public anchor" id="var-fs-path"><h3>fs-path</h3><div class="usage"><code>(fs-path path)</code></div><div class="doc"><div class="markdown"><p>Takes a cache path, and returns a sequence of filenames for that path.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L106">view source</a></div></div><div class="public anchor" id="var-load-edn"><h3>load-edn</h3><div class="usage"><code>(load-edn path)</code></div><div class="doc"><div class="markdown"><p>Reads the given cache path as an EDN structure, returning data. Returns nil if file does not exist.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L240">view source</a></div></div><div class="public anchor" id="var-load-file"><h3>load-file</h3><div class="usage"><code>(load-file path)</code></div><div class="doc"><div class="markdown"><p>The local File backing a given path. Returns nil if no file exists.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L211">view source</a></div></div><div class="public anchor" id="var-load-string"><h3>load-string</h3><div class="usage"><code>(load-string path)</code></div><div class="doc"><div class="markdown"><p>Returns the cached value for a given path as a string, or nil if uncached.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L225">view source</a></div></div><div class="public anchor" id="var-locking"><h3>locking</h3><h4 class="type">macro</h4><div class="usage"><code>(locking path &amp; body)</code></div><div class="doc"><div class="markdown"><p>Acquires a lock for a particular cache path, and evaluates body. Helpful for reducing concurrent evaluation of expensive cache misses.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L277">view source</a></div></div><div class="public anchor" id="var-locks"><h3>locks</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L274">view source</a></div></div><div class="public anchor" id="var-save-edn.21"><h3>save-edn!</h3><div class="usage"><code>(save-edn! data path)</code></div><div class="doc"><div class="markdown"><p>Writes the given data structure to an EDN file. Returns data.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L231">view source</a></div></div><div class="public anchor" id="var-save-file.21"><h3>save-file!</h3><div class="usage"><code>(save-file! file path)</code></div><div class="doc"><div class="markdown"><p>Caches a File object to the given path. Returns file.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L204">view source</a></div></div><div class="public anchor" id="var-save-remote.21"><h3>save-remote!</h3><div class="usage"><code>(save-remote! remote-path cache-path)</code></div><div class="doc"><div class="markdown"><p>Caches a remote path (a string) to a cache path by SCPing it down. Returns remote-path.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L247">view source</a></div></div><div class="public anchor" id="var-save-string.21"><h3>save-string!</h3><div class="usage"><code>(save-string! string path)</code></div><div class="doc"><div class="markdown"><p>Caches the given string to a cache path. Returns string.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L218">view source</a></div></div><div class="public anchor" id="var-write-atomic.21"><h3>write-atomic!</h3><h4 class="type">macro</h4><div class="usage"><code>(write-atomic! [tmp-sym final] &amp; body)</code></div><div class="doc"><div class="markdown"><p>Writes a file atomically. Takes a binding form and a body, like so</p>
<p>(write-atomic <a href="tmp-file (io/file &quot;final.txt&quot;)">tmp-file (io/file “final.txt”)</a> (write! tmp-file))</p>
<p>Creates a temporary file, and binds it to <code>tmp-file</code>. Evals body, presumably modifying tmp-file in some way. If body terminates normally, renames tmp-file to final-file. Ensures temp file is cleaned up.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.5/jepsen/src/jepsen/fs_cache.clj#L164">view source</a></div></div></div></body></html>