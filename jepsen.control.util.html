<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jepsen.control.util documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jepsen</span> <span class="project-version">0.1.16</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jepsen</span></div></div></li><li class="depth-2 branch"><a href="jepsen.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-2"><a href="jepsen.checker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clock</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.perf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>perf</span></div></a></li><li class="depth-3"><a href="jepsen.checker.timeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timeline</span></div></a></li><li class="depth-2 branch"><a href="jepsen.cli.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="jepsen.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="jepsen.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2"><a href="jepsen.control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.net.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3 current"><a href="jepsen.control.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="jepsen.core.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="jepsen.faketime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faketime</span></div></a></li><li class="depth-2"><a href="jepsen.generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generator</span></div></a></li><li class="depth-3"><a href="jepsen.generator.pure.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pure</span></div></a></li><li class="depth-2 branch"><a href="jepsen.independent.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>independent</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nemesis</span></div></a></li><li class="depth-3 branch"><a href="jepsen.nemesis.combined.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>combined</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="jepsen.net.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.net.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="jepsen.os.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>os</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.centos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>centos</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.debian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debian</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.smartos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smartos</span></div></a></li><li class="depth-3"><a href="jepsen.os.ubuntu.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ubuntu</span></div></a></li><li class="depth-2 branch"><a href="jepsen.reconnect.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>reconnect</span></div></a></li><li class="depth-2 branch"><a href="jepsen.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="jepsen.report.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></a></li><li class="depth-2 branch"><a href="jepsen.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-2"><a href="jepsen.tests.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.bank.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bank</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal-reverse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-reverse</span></div></a></li><li class="depth-3"><a href="jepsen.tests.cycle.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cycle</span></div></a></li><li class="depth-4"><a href="jepsen.tests.cycle.append.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>append</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.linearizable-register.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>linearizable-register</span></div></a></li><li class="depth-3"><a href="jepsen.tests.long-fork.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>long-fork</span></div></a></li><li class="depth-2 branch"><a href="jepsen.util.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="jepsen.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jepsen.control.util.html#var-cached-wget.21"><div class="inner"><span>cached-wget!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-daemon-running.3F"><div class="inner"><span>daemon-running?</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-encode"><div class="inner"><span>encode</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-ensure-user.21"><div class="inner"><span>ensure-user!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-exists.3F"><div class="inner"><span>exists?</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-file.3F"><div class="inner"><span>file?</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-grepkill.21"><div class="inner"><span>grepkill!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-install-archive.21"><div class="inner"><span>install-archive!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-install-tarball.21"><div class="inner"><span>install-tarball!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-ls"><div class="inner"><span>ls</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-ls-full"><div class="inner"><span>ls-full</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-signal.21"><div class="inner"><span>signal!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-start-daemon.21"><div class="inner"><span>start-daemon!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-std-wget-opts"><div class="inner"><span>std-wget-opts</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-stop-daemon.21"><div class="inner"><span>stop-daemon!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-tmp-dir.21"><div class="inner"><span>tmp-dir!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-tmp-dir-base"><div class="inner"><span>tmp-dir-base</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-wget.21"><div class="inner"><span>wget!</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-wget-cache-dir"><div class="inner"><span>wget-cache-dir</span></div></a></li><li class="depth-1"><a href="jepsen.control.util.html#var-wget-helper.21"><div class="inner"><span>wget-helper!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jepsen.control.util</h1><div class="doc"><div class="markdown"><p>Utility functions for scripting installations.</p></div></div><div class="public anchor" id="var-cached-wget.21"><h3>cached-wget!</h3><div class="usage"><code>(cached-wget! url)</code><code>(cached-wget! url opts)</code></div><div class="doc"><div class="markdown"><p>Downloads a string URL to the Jepsen wget cache directory, and returns the full local filename as a string. Skips if the file already exists. Local filenames are base64-encoded URLs, as opposed to the name of the file–this is helpful when you want to download a package like <a href="https://foo.com/v1.2/foo.tar">https://foo.com/v1.2/foo.tar</a>; since the version is in the URL but not a part of the filename, downloading a new version could silently give you the old version instead.</p>
<p>Options:</p>
<p>:force? Even if we have this cached, download the tarball again anyway.  :user? User for wget authentication. If provided, valid pw must also be provided.  :pw? Password for wget authentication.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L113">view source</a></div></div><div class="public anchor" id="var-daemon-running.3F"><h3>daemon-running?</h3><div class="usage"><code>(daemon-running? pidfile)</code></div><div class="doc"><div class="markdown"><p>Given a pidfile, returns true if the pidfile is present and the process it contains is alive, nil if the pidfile is absent, false if it’s present and the process doesn’t exist.</p>
<p>Strictly this doesn’t mean the process is RUNNING; it could be asleep or a zombie, but you know what I mean. ;-)</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L307">view source</a></div></div><div class="public anchor" id="var-encode"><h3>encode</h3><div class="usage"><code>(encode s)</code></div><div class="doc"><div class="markdown"><p>base64 encode a given string and return the encoded string in utf8</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L108">view source</a></div></div><div class="public anchor" id="var-ensure-user.21"><h3>ensure-user!</h3><div class="usage"><code>(ensure-user! username)</code></div><div class="doc"><div class="markdown"><p>Make sure a user exists.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L229">view source</a></div></div><div class="public anchor" id="var-exists.3F"><h3>exists?</h3><div class="usage"><code>(exists? filename)</code></div><div class="doc"><div class="markdown"><p>Is a path present?</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L19">view source</a></div></div><div class="public anchor" id="var-file.3F"><h3>file?</h3><div class="usage"><code>(file? filename)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L13">view source</a></div></div><div class="public anchor" id="var-grepkill.21"><h3>grepkill!</h3><div class="usage"><code>(grepkill! pattern)</code><code>(grepkill! signal pattern)</code></div><div class="doc"><div class="markdown"><p>Kills processes by grepping for the given string. If a signal is given, sends that signal instead. Signals may be either numbers or names, e.g. :term, :hup, …</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L238">view source</a></div></div><div class="public anchor" id="var-install-archive.21"><h3>install-archive!</h3><div class="usage"><code>(install-archive! url dest)</code><code>(install-archive! url dest opts)</code></div><div class="doc"><div class="markdown"><p>Gets the given tarball URL, caching it in /tmp/jepsen/, and extracts its sole top-level directory to the given dest directory. Deletes current contents of dest. Supports both zip files and tarballs, compressed or raw. Returns dest.</p>
<p>Standard practice for release tarballs is to include a single directory, often named something like foolib-1.2.3-amd64, with files inside it. If only a single directory is present, its <em>contents</em> will be moved to dest, so foolib-1.2.3-amd64/my.file becomes dest/my.file. If the tarball includes multiple files, those files are moved to dest, so my.file becomes dest/my.file.</p>
<p>Options:</p>
<p>:force? Even if we have this cached, download the tarball again anyway.  :user? User for wget authentication. If provided, valid pw must also be provided.  :pw? Password for wget authentication.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L145">view source</a></div></div><div class="public anchor" id="var-install-tarball.21"><h3>install-tarball!</h3><div class="usage"><code>(install-tarball! node url dest)</code><code>(install-tarball! node url dest force?)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L222">view source</a></div></div><div class="public anchor" id="var-ls"><h3>ls</h3><div class="usage"><code>(ls)</code><code>(ls dir)</code></div><div class="doc"><div class="markdown"><p>A seq of directory entries (not including . and ..). TODO: escaping for control chars in filenames (if you do this, WHO ARE YOU???)</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L26">view source</a></div></div><div class="public anchor" id="var-ls-full"><h3>ls-full</h3><div class="usage"><code>(ls-full dir)</code></div><div class="doc"><div class="markdown"><p>Like ls, but prepends dir to each entry.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L34">view source</a></div></div><div class="public anchor" id="var-signal.21"><h3>signal!</h3><div class="usage"><code>(signal! process-name signal)</code></div><div class="doc"><div class="markdown"><p>Sends a signal to a named process by signal number or name.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L320">view source</a></div></div><div class="public anchor" id="var-start-daemon.21"><h3>start-daemon!</h3><div class="usage"><code>(start-daemon! opts bin &amp; args)</code></div><div class="doc"><div class="markdown"><p>Starts a daemon process, logging stdout and stderr to the given file. Invokes <code>bin</code> with <code>args</code>. Options are:</p>
<p>:background? :chdir :logfile :make-pidfile? :match-executable? :match-process-name? :pidfile :process-name</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L262">view source</a></div></div><div class="public anchor" id="var-std-wget-opts"><h3>std-wget-opts</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A list of standard options we pass to wget</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L54">view source</a></div></div><div class="public anchor" id="var-stop-daemon.21"><h3>stop-daemon!</h3><div class="usage"><code>(stop-daemon! pidfile)</code><code>(stop-daemon! cmd pidfile)</code></div><div class="doc"><div class="markdown"><p>Kills a daemon process by pidfile, or, if given a command name, kills all processes with that command name, and cleans up pidfile.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L292">view source</a></div></div><div class="public anchor" id="var-tmp-dir.21"><h3>tmp-dir!</h3><div class="usage"><code>(tmp-dir!)</code></div><div class="doc"><div class="markdown"><p>Creates a temporary directory under /tmp/jepsen and returns its path.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L44">view source</a></div></div><div class="public anchor" id="var-tmp-dir-base"><h3>tmp-dir-base</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Where should we put temporary files?</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L11">view source</a></div></div><div class="public anchor" id="var-wget.21"><h3>wget!</h3><div class="usage"><code>(wget! url)</code><code>(wget! url opts)</code></div><div class="doc"><div class="markdown"><p>Downloads a string URL and returns the filename as a string. Skips if the file already exists.</p>
<p>Options:</p>
<p>:force? Even if we have this cached, download the tarball again anyway.  :user? User for wget authentication. If provided, valid pw must also be provided.  :pw? Password for wget authentication.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L79">view source</a></div></div><div class="public anchor" id="var-wget-cache-dir"><h3>wget-cache-dir</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Directory for caching files from the web.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L104">view source</a></div></div><div class="public anchor" id="var-wget-helper.21"><h3>wget-helper!</h3><div class="usage"><code>(wget-helper! &amp; args)</code></div><div class="doc"><div class="markdown"><p>A helper for wget! and cached-wget!. Calls wget with options; catches name resolution and other network errors, and retries them. EC2 name resolution can be surprisingly flaky.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.16/jepsen/src/jepsen/control/util.clj#L63">view source</a></div></div></div></body></html>