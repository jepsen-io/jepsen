<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jepsen.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jepsen</span> <span class="project-version">0.2.8-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jepsen</span></div></div></li><li class="depth-2 branch"><a href="jepsen.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-2"><a href="jepsen.checker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clock</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.perf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>perf</span></div></a></li><li class="depth-3"><a href="jepsen.checker.timeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timeline</span></div></a></li><li class="depth-2 branch"><a href="jepsen.cli.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="jepsen.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="jepsen.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2"><a href="jepsen.control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.clj-ssh.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-ssh</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.docker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>docker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.k8s.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>k8s</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.net.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.retry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>retry</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.scp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scp</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.sshj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sshj</span></div></a></li><li class="depth-3"><a href="jepsen.control.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch current"><a href="jepsen.core.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="jepsen.faketime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faketime</span></div></a></li><li class="depth-2 branch"><a href="jepsen.fs-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fs-cache</span></div></a></li><li class="depth-2"><a href="jepsen.generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generator</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.interpreter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interpreter</span></div></a></li><li class="depth-3"><a href="jepsen.generator.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-2 branch"><a href="jepsen.independent.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>independent</span></div></a></li><li class="depth-2 branch"><a href="jepsen.lazyfs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lazyfs</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nemesis</span></div></a></li><li class="depth-3 branch"><a href="jepsen.nemesis.combined.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>combined</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.membership.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>membership</span></div></a></li><li class="depth-4"><a href="jepsen.nemesis.membership.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.time.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="jepsen.net.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.net.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="jepsen.os.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>os</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.centos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>centos</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.debian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debian</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.smartos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smartos</span></div></a></li><li class="depth-3"><a href="jepsen.os.ubuntu.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ubuntu</span></div></a></li><li class="depth-2 branch"><a href="jepsen.reconnect.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>reconnect</span></div></a></li><li class="depth-2 branch"><a href="jepsen.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="jepsen.report.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></a></li><li class="depth-2"><a href="jepsen.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-3 branch"><a href="jepsen.store.format.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>format</span></div></a></li><li class="depth-3"><a href="jepsen.store.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2"><a href="jepsen.tests.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.bank.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bank</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal-reverse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-reverse</span></div></a></li><li class="depth-3"><a href="jepsen.tests.cycle.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cycle</span></div></a></li><li class="depth-4 branch"><a href="jepsen.tests.cycle.append.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>append</span></div></a></li><li class="depth-4"><a href="jepsen.tests.cycle.wr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wr</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.linearizable-register.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>linearizable-register</span></div></a></li><li class="depth-3"><a href="jepsen.tests.long-fork.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>long-fork</span></div></a></li><li class="depth-2 branch"><a href="jepsen.util.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="jepsen.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jepsen.core.html#var-analyze.21"><div class="inner"><span>analyze!</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-conj-op.21"><div class="inner"><span>conj-op!</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-log-results"><div class="inner"><span>log-results</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-log-test-start.21"><div class="inner"><span>log-test-start!</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-maybe-snarf-logs.21"><div class="inner"><span>maybe-snarf-logs!</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-prepare-test"><div class="inner"><span>prepare-test</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-primary"><div class="inner"><span>primary</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-run.21"><div class="inner"><span>run!</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-run-case.21"><div class="inner"><span>run-case!</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-snarf-logs.21"><div class="inner"><span>snarf-logs!</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-synchronize"><div class="inner"><span>synchronize</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-with-client.2Bnemesis-setup-teardown"><div class="inner"><span>with-client+nemesis-setup-teardown</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-with-db"><div class="inner"><span>with-db</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-with-log-snarfing"><div class="inner"><span>with-log-snarfing</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-with-logging"><div class="inner"><span>with-logging</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-with-os"><div class="inner"><span>with-os</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-with-resources"><div class="inner"><span>with-resources</span></div></a></li><li class="depth-1"><a href="jepsen.core.html#var-with-sessions"><div class="inner"><span>with-sessions</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jepsen.core</h1><div class="doc"><div class="markdown"><p>Entry point for all Jepsen tests. Coordinates the setup of servers, running tests, creating and resolving failures, and interpreting results.</p>
<p>Jepsen tests a system by running a set of singlethreaded <em>processes</em>, each representing a single client in the system, and a special <em>nemesis</em> process, which induces failures across the cluster. Processes choose operations to perform based on a <em>generator</em>. Each process uses a <em>client</em> to apply the operation to the distributed system, and records the invocation and completion of that operation in the <em>history</em> for the test. When the test is complete, a <em>checker</em> analyzes the history to see if it made sense.</p>
<p>Jepsen automates the setup and teardown of the environment and distributed system by using an <em>OS</em> and <em>client</em> respectively. See <code>run!</code> for details.</p>
</div></div><div class="public anchor" id="var-analyze.21"><h3>analyze!</h3><div class="usage"><code>(analyze! test writer)</code></div><div class="doc"><div class="markdown"><p>After running the test and obtaining a history, we perform some post-processing on the history, run the checker, and write the test to disk again. Takes a test map and a writer. Returns a new test with results.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L216">view source</a></div></div><div class="public anchor" id="var-conj-op.21"><h3>conj-op!</h3><div class="usage"><code>(conj-op! test op)</code></div><div class="doc"><div class="markdown"><p>Add an operation to a tests’s history, and returns the operation.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L59">view source</a></div></div><div class="public anchor" id="var-log-results"><h3>log-results</h3><div class="usage"><code>(log-results test)</code></div><div class="doc"><div class="markdown"><p>Logs info about the results of a test to stdout, and returns test.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L234">view source</a></div></div><div class="public anchor" id="var-log-test-start.21"><h3>log-test-start!</h3><div class="usage"><code>(log-test-start! test)</code></div><div class="doc"><div class="markdown"><p>Logs some basic information at the start of a test: the Git version of the working directory, the lein arguments to re-run the test, etc.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L249">view source</a></div></div><div class="public anchor" id="var-maybe-snarf-logs.21"><h3>maybe-snarf-logs!</h3><div class="usage"><code>(maybe-snarf-logs! test)</code></div><div class="doc"><div class="markdown"><p>Snarfs logs, swallows and logs all throwables. Why? Because we do this when we encounter an error and abort, and we don’t want an error here to supercede the root cause that made us abort.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L131">view source</a></div></div><div class="public anchor" id="var-prepare-test"><h3>prepare-test</h3><div class="usage"><code>(prepare-test test)</code></div><div class="doc"><div class="markdown"><p>Takes a test and ensures it has a :start-time, :concurrency, and :barrier field. This operation always succeeds, and is necessary for accessing a test’s store directory, which depends on :start-time. You may call this yourself before calling run!, if you need access to the store directory outside the run! context.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L306">view source</a></div></div><div class="public anchor" id="var-primary"><h3>primary</h3><div class="usage"><code>(primary test)</code></div><div class="doc"><div class="markdown"><p>Given a test, returns the primary node.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L65">view source</a></div></div><div class="public anchor" id="var-run.21"><h3>run!</h3><div class="usage"><code>(run! test)</code></div><div class="doc"><div class="markdown"><p>Runs a test. Tests are maps containing</p>
<p>:nodes      A sequence of string node names involved in the test :concurrency  (optional) How many processes to run concurrently :ssh        SSH credential information: a map containing… :username           The username to connect with   (root) :password           The password to use :sudo-password      The password to use for sudo, if needed :port               SSH listening port (22) :private-key-path   A path to an SSH identity file (~/.ssh/id_rsa) :strict-host-key-checking  Whether or not to verify host keys :logging    Logging options; see jepsen.store/start-logging! :os         The operating system; given by the OS protocol :db         The database to configure: given by the DB protocol :remote     The remote to use for control actions. Try, for example, (jepsen.control.sshj/remote). :client     A client for the database :nemesis    A client for failures :generator  A generator of operations to apply to the DB :checker    Verifies that the history is valid :log-files  A list of paths to logfiles/dirs which should be captured at the end of the test. :nonserializable-keys   A collection of top-level keys in the test which shouldn’t be serialized to disk. :leave-db-running? Whether to leave the DB running at the end of the test.</p>
<p>Tests proceed like so:</p>
<ol>
<li>
<p>Setup the operating system</p>
</li>
<li>
<p>Try to teardown, then setup the database</p>
</li>
</ol>
<ul>
<li>If the DB supports the Primary protocol, also perform the Primary setup on the first node.</li>
</ul>
<ol>
<li>
<p>Create the nemesis</p>
</li>
<li>
<p>Fork the client into one client for each node</p>
</li>
<li>
<p>Fork a thread for each client, each of which requests operations from the generator until the generator returns nil</p>
</li>
</ol>
<ul>
<li>Each operation is appended to the operation history</li>
<li>The client executes the operation and returns a vector of history elements
<ul>
<li>which are appended to the operation history</li>
</ul>
</li>
</ul>
<ol>
<li>
<p>Capture log files</p>
</li>
<li>
<p>Teardown the database</p>
</li>
<li>
<p>Teardown the operating system</p>
</li>
<li>
<p>When the generator is finished, invoke the checker with the history</p>
</li>
</ol>
<ul>
<li>This generates the final report</li>
</ul>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L322">view source</a></div></div><div class="public anchor" id="var-run-case.21"><h3>run-case!</h3><div class="usage"><code>(run-case! test)</code></div><div class="doc"><div class="markdown"><p>Takes a test, spawns nemesis and clients, runs the generator, and returns the history.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L209">view source</a></div></div><div class="public anchor" id="var-snarf-logs.21"><h3>snarf-logs!</h3><div class="usage"><code>(snarf-logs! test)</code></div><div class="doc"><div class="markdown"><p>Downloads logs for a test. Updates symlinks.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L102">view source</a></div></div><div class="public anchor" id="var-synchronize"><h3>synchronize</h3><div class="usage"><code>(synchronize test)</code><code>(synchronize test timeout-s)</code></div><div class="doc"><div class="markdown"><p>A synchronization primitive for tests. When invoked, blocks until all nodes have arrived at the same point.</p>
<p>This is often used in IO-heavy DB setup code to ensure all nodes have completed some phase of execution before moving on to the next. However, if an exception is thrown by one of those threads, the call to <code>synchronize</code> will deadlock! To avoid this, we include a default timeout of 60 seconds, which can be overridden by passing an alternate timeout in seconds.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L44">view source</a></div></div><div class="public anchor" id="var-with-client.2Bnemesis-setup-teardown"><h3>with-client+nemesis-setup-teardown</h3><h4 class="type">macro</h4><div class="usage"><code>(with-client+nemesis-setup-teardown [test-sym test] &amp; body)</code></div><div class="doc"><div class="markdown"><p>Takes a binding vector of a test symbol and a test map. Sets up clients and nemesis, and rebinds (:nemesis test) to the set-up nemesis. Evaluates body. Afterwards, ensures clients and nemesis are torn down.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L176">view source</a></div></div><div class="public anchor" id="var-with-db"><h3>with-db</h3><h4 class="type">macro</h4><div class="usage"><code>(with-db test &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wraps body in DB setup and teardown.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L165">view source</a></div></div><div class="public anchor" id="var-with-log-snarfing"><h3>with-log-snarfing</h3><h4 class="type">macro</h4><div class="usage"><code>(with-log-snarfing test &amp; body)</code></div><div class="doc"><div class="markdown"><p>Evaluates body and ensures logs are snarfed afterwards. Will also download logs in the event of JVM shutdown, so you can ctrl-c a test and get something useful.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L143">view source</a></div></div><div class="public anchor" id="var-with-logging"><h3>with-logging</h3><h4 class="type">macro</h4><div class="usage"><code>(with-logging test &amp; body)</code></div><div class="doc"><div class="markdown"><p>Sets up logging for this test run, logs the start of the test, evaluates body, and stops logging at the end. Also logs test crashes, so they appear in the log files for this test run.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L292">view source</a></div></div><div class="public anchor" id="var-with-os"><h3>with-os</h3><h4 class="type">macro</h4><div class="usage"><code>(with-os test &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wraps body in OS setup and teardown.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L93">view source</a></div></div><div class="public anchor" id="var-with-resources"><h3>with-resources</h3><h4 class="type">macro</h4><div class="usage"><code>(with-resources [sym start stop resources] &amp; body)</code></div><div class="doc"><div class="markdown"><p>Takes a four-part binding vector: a symbol to bind resources to, a function to start a resource, a function to stop a resource, and a sequence of resources. Then takes a body. Starts resources in parallel, evaluates body, and ensures all resources are correctly closed in the event of an error.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L70">view source</a></div></div><div class="public anchor" id="var-with-sessions"><h3>with-sessions</h3><h4 class="type">macro</h4><div class="usage"><code>(with-sessions [test' test] &amp; body)</code></div><div class="doc"><div class="markdown"><p>Takes a <a href="test' test">test’ test</a> binding form and a body. Starts with test-expr as the test, and sets up the jepsen.control state required to run this test–the remote, SSH options, etc. Opens SSH sessions to each node. Saves those sessions in the :sessions map of the test, binds that to the <code>test'</code> symbol in the binding expression, and evaluates body.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.2.8-SNAPSHOT/jepsen/src/jepsen/core.clj#L270">view source</a></div></div></div></body></html>